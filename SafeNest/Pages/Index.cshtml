@page
@model SafeNest.Pages.IndexModel
@{
    ViewData["Title"] = "SafeNest Dashboard";
}

<div class="container mt-5">
    <h2 class="text-center mb-4">SafeNest Dashboard</h2>

    <!-- WEATHER CARD -->
    <div id="weatherCard" style="
    background:#f1f5f9;
    padding:20px;
    margin-top:20px;
    border-radius:12px;
    width:300px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
">
        <h2 style="margin-bottom:10px;">Local Weather</h2>

        <p id="weatherStatus">Detecting your location...</p>
        <p id="weatherTemp" style="font-size:24px; font-weight:bold;"></p>
        <p id="weatherCity"></p>
    </div>

    <script src="/js/weather.js"></script>

    <!-- Motion Detection -->
    <div class="mb-4">
        <h4>Motion Detection</h4>
        <button id="getLocationBtn" class="btn btn-success">Get Current Location</button>
        <p id="locationOutput" class="mt-2"></p>
    </div>

    <!-- Add Sensor Reading -->
    <div class="mb-4">
        <h4>Add Sensor Reading</h4>
        <form method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <div class="form-group">
                <label>Sensor Type</label>
                <input asp-for="SensorType" class="form-control" placeholder="e.g., Motion" />
                <span asp-validation-for="SensorType" class="text-danger"></span>
            </div>

            <div class="form-group mt-2">
                <label>Sensor Value</label>
                <input asp-for="SensorValue" class="form-control" placeholder="Enter value" />
                <span asp-validation-for="SensorValue" class="text-danger"></span>
            </div>

            <button type="submit" class="btn btn-primary mt-3">Add Reading</button>
        </form>
    </div>

    <!-- Saved Sensor Data -->
    <div>
        <h4>Saved Sensor Data</h4>
        <table class="table table-striped table-bordered">
            <thead class="bg-dark text-white">
                <tr>
                    <th>Type</th>
                    <th>Value</th>
                    <th>Time</th> <!-- use Time property -->
                </tr>
            </thead>
            <tbody>
                @foreach (var reading in IndexModel.Readings)
                {
                    <tr>
                        <td>@reading.SensorType</td>
                        <td>@reading.Value</td>
                        <td>@reading.Time</td> <!-- display Time -->
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <!-- Geolocation script -->
    <script>
        const btn = document.getElementById("getLocationBtn");
        const output = document.getElementById("locationOutput");

        btn.addEventListener("click", () => {
            if (!navigator.geolocation) {
                output.textContent = "Geolocation not supported by your browser";
            } else {
                navigator.geolocation.getCurrentPosition(
                    pos => output.textContent = `Latitude: ${pos.coords.latitude}, Longitude: ${pos.coords.longitude}`,
                    err => output.textContent = "Unable to retrieve location"
                );
            }
        });
    </script>
}
